name: ninja
version: 1.12.1
release: 1
url: https://github.com/ninja-build/ninja/archive/v1.12.1/ninja-1.12.1.tar.gz
homepage: https://ninja-build.org/
license: Apache-2.0
summary: A small build system with a focus on speed
description: |
  Ninja is a small build system with a focus on speed. It differs from other build systems in two major respects: it is designed to have its input files generated by a higher-level build system, and it is designed to run builds as fast as possible.
phase: 4
order: 275
critical: true
buildsteps: |
  export NINJAJOBS=4

  sed -i '/int Guess/a \
    int   j = 0;\
    char* jobs = getenv( "NINJAJOBS" );\
    if ( jobs != NULL ) j = atoi( jobs );\
    if ( j > 0 ) return j;\
  ' src/ninja.cc

  python3 configure.py --bootstrap

  if [ "$RUN_TESTS" = "1" ]; then
      set +e
      ./ninja ninja_test
      ./ninja_test --gtest_filter=-SubprocessTest.SetWithLots
      set -e
  fi

  install -m755 ninja /usr/bin/
  install -Dm644 misc/bash-completion /usr/share/bash-completion/completions/ninja
  install -Dm644 misc/zsh-completion  /usr/share/zsh/site-functions/_ninja

